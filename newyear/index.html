<!DOCTYPE html>
<html>
    <head>
        <title>Trojka software: Nieuwjaar</title>
        <style type="text/css">
            body{font-family: arial; background: #FFFFFF}
			#getFontSize {
				font-size: 3em; visibility: hidden
			}
        </style>
    </head>
    <body>
		<span >
			<iframe src="https://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Ftrojka.github.io%2Fnewyear%2Findex.html&text=Nieuwjaar%20wensen&hashtags=trojkasoftware"
					style="position: static; visibility: visible; width: 61px; height: 20px; border: 0; overflow: hidden;" 
					title="Twitter Tweet Button"
					frameborder="0"
					scrolling="no"
					></iframe>
			<span class="IN-widget" style="line-height: 1; vertical-align: baseline; display: inline-block; text-align: center;">
				<script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
				<script type="IN/Share" data-url="https://trojka.github.io/newyear/index.html" data-counter="top">
				</script>
			</span>
		</div>
		<h1 id="getFontSize">Hidden header</h1>
        <div id="canvas"></div>

	<!--Script at the bottom of the page-->
	<script type="text/javascript" src="script/raphael.js" /></script>
	<script type="text/javascript" src="script/jquery-3.1.1.min.js" /></script>
    <script>
	
		var size = $("#getFontSize").css('font-size');

		//alert("size:" + size);

		var pathStyle = {
			"opacity":0
		}

		//var newYear = new Date(2016, 11, 15, 23, 15, 0);
		var newYear = new Date(2017, 0, 1, 0, 0, 0);
		var now = new Date();
		//var now1 = new Date(2016, 11, 31, 23, 59, 1);

		//console.log(now);

		function pad2(num) {
			var s = "0" + num;
			return s.substr(s.length - 2);
		}

		function trojkaLogo(canvas, x, y, size) {
			canvas.setStart();

			var strokeWidth = 35;
			var scale = size / (2 * 339.68405);

			canvas.ellipse(371.07144, 512.4693, 339.68405, 339.68405).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			var face1 = "m 231.07143,292.71932 -120,240 120,0 0,200.00002 80,0";
			var face2 = "m 391.07143,292.71932 -120,240 120,0 0,200.00002 80,-40";
			var face3 = "m 551.07143,292.71932 -120,240 120,0 0,200.00002 80,-80";
			canvas.path(face1).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			canvas.path(face2).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			canvas.path(face3).attr({ fill: "none", "stroke": "#000000", "stroke-width": scale * strokeWidth, "stroke-linecap": "round", "stroke-linejoin": "round" });
			canvas.circle(273.57144, 375.21933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });
			canvas.circle(433.07144, 375.71933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });
			canvas.circle(593.07141, 375.71933, strokeWidth / 2).attr({ fill: "#000000", "stroke": "#000000", "stroke-width": 1 });

			var completeSet = canvas.setFinish();
			var tX = -371.07144;
			var tY = -512.4693;
			completeSet.transform("S" + scale + "," + scale + ",371.07,512.47T" + (tX + x) + "," + (tY + y));//.transform("");
		}

		function prettyTimespan(start, end) {
			var diff = end.getTime() - start.getTime();
			var days = Math.floor(diff / (1000 * 60 * 60 * 24));
			diff -= days * (1000 * 60 * 60 * 24);
			var hours = Math.floor(diff / (1000 * 60 * 60));
			diff -= hours * (1000 * 60 * 60);
			var mins = Math.floor(diff / (1000 * 60));
			diff -= mins * (1000 * 60);
			var seconds = Math.floor(diff / (1000));
			diff -= seconds * (1000);

			var timeMessage = "";
			if (days > 0)
				timeMessage = "Nog langer dan " + days + ((days > 1) ? " dagen" : " dag");
			else {
				var hoursMessage = "";
				if (hours > 0)
					timeMessage = "Nog langer dan " + hours + ((hours > 1) ? " uren" : " uur");
				else {
					var minutesMessage = "";
					if (mins > 0)
						minutesMessage = mins + ((mins > 1) ? " minuten" : " minuut");
					var secondsMessage = "";
					if (seconds > 0)
						secondsMessage = seconds + " seconden";

					timeMessage = "Nog " + minutesMessage + ((minutesMessage != "") ? " en " : "") + secondsMessage;
				}
			}

			return timeMessage;
		}

		function prettyFullTimespan(start, end) {
			var diff = end.getTime() - start.getTime();
			if (diff < 0) {
				return "De tijd is verstreken";
			}

			var days = Math.floor(diff / (1000 * 60 * 60 * 24));
			diff -= days * (1000 * 60 * 60 * 24);
			var hours = Math.floor(diff / (1000 * 60 * 60));
			diff -= hours * (1000 * 60 * 60);
			var mins = Math.floor(diff / (1000 * 60));
			diff -= mins * (1000 * 60);
			var seconds = Math.floor(diff / (1000));
			diff -= seconds * (1000);

			var timeMessage = "";
			var dayMessage = "";
			if (days > 0)
				dayMessage = days + ((days > 1) ? " dagen" : " dag");
			var hoursMessage = "";
			if (hours > 0)
				hoursMessage = (days > 0 ? " " : "") + pad2(hours) + ":";
			var minutesMessage = "";
			var secondsMessage = "";
			if (days == 0 && hours == 0 && mins == 0)  {
				secondsMessage = seconds + " seconden";
			}
			else {
				minutesMessage = pad2(mins) + ":";
				secondsMessage = pad2(seconds);
			}

			return "Nog " + dayMessage + hoursMessage + minutesMessage + secondsMessage;
		}

		var prettyMessage = prettyTimespan(now, newYear);


		var timeFunction = function () {
			var fullPrettyMessage = prettyFullTimespan(new Date(), newYear)
			//console.log(fullPrettyMessage);

			var prettyTimeElem = paper.getById('timeText');
			if (prettyTimeElem == undefined) {
				console.log("prettyTimeElem == undefined");
				var verticalOffset = 170;
				var logoMargin = 30;
				trojkaLogo(paper, offsetWidth / 2, verticalOffset/2, (verticalOffset - 2*logoMargin));
				prettyTimeElem = paper.text(offsetWidth / 2, verticalOffset, "").attr({ id: 'timeText' }).attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "middle" }).attr({ fill: '#000000' });
				prettyTimeElem.id = 'timeText';
			}
			prettyTimeElem.attr({ text: fullPrettyMessage });
		};


		//console.log(prettyMessage);




        var paper = Raphael("canvas", '100%', 500);  
		var offsetWidth = $("#canvas").width();
		
		var t11 = paper.text(50, 50, "Wat gebeurt er?").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' });
		var t21 = paper.text(offsetWidth - 50, 70, "Vuurwerk...").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' });
		var t12 = paper.text(50, 90, "Wanneer?").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' });
		var t22 = paper.text(offsetWidth - 50, 110, prettyMessage).attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' });
		var t13 = paper.text(50, 130, "Nog zo lang?").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' });
		var t24 = paper.text(offsetWidth - 50, 150, "Kom dan nog eens terug.").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "end" }).attr({ fill: '#FFFFFF' });
		var t14 = paper.text(50, 170, "Doe ik...").attr({ "font-size": size, "font-family": "Arial, Helvetica, sans-serif", "text-anchor": "start" }).attr({ fill: '#FFFFFF' });

		var fadeDuration = 700;
		var fixDuration = 1500;
		var pauseDuration = 200;
		var cycleDuration = 2 * fadeDuration + fixDuration + pauseDuration;
		
		var fadeOutAnimation = Raphael.animation({
			"fill" : "#FFFFFF",
		}, fadeDuration);
	
		var fadeInOutAnimation = Raphael.animation({
			"fill" : "#000000",
		}, fadeDuration, function () {
			this.animate(fadeOutAnimation.delay(fixDuration));
			//console.log(step);
		});


		var fadeOutAndStartCountDownAnimation = Raphael.animation({
			"fill": "#FFFFFF",
		}, fadeDuration, function () {
			setInterval(timeFunction, 1000);
		});

		var fadeInOutAndStartCountDownAnimation = Raphael.animation({
			"fill": "#000000",
		}, fadeDuration, function () {
			this.animate(fadeOutAndStartCountDownAnimation.delay(fixDuration));
		});

		var step = 0;
		t11.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t21.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t12.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t22.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		//t23.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t13.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t24.animate(fadeInOutAnimation.delay(step * cycleDuration)); step++;
		t14.animate(fadeInOutAndStartCountDownAnimation.delay(step * cycleDuration)); step++;


    </script>
</body>
</html>
